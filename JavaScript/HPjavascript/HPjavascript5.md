# 字符串和正则表达式


## 字符串连接

字符串连接可能对性能造成很大影响。通常一个任务通过一个循环，想字符串末尾不断地添加内容，来创建一个字符串，但此类处理在一些浏览器上表现的糟糕。

首先有多种方法可以合并字符串：
```
str="a"+"b"
str+="a"
str=["a","b"].join("")
str=str.concat("a","b")
```

当连接少量字符串的时候，所有的方法都很快，这时候可以选择最熟悉的。当合并的字符串长度和数量增加到一定程度的时候，它们之间的性能差异就开始显现了。

`+` 和 `+=` ：这些操作符提供了连接字符串的最简单方法，实际上，除了ie7和它之前的所有现代浏览器都对此优化的很好。不过还是有一些技术可以最大限度的提高这些操作的效率。

例子：
```
str+="a"+"b"
```
此代码执行会创建一个临时字符串 'ab' 然后再将临时字符串和 str 进行连接。
我们可以通过下面的：
```
str+='a'
str+='b'
```
来避免临时字符串的生成，这样在大多数浏览器上可以加快10%-40%
实际上可以用一行代码实现上面的性能提升：
`str=str+'a'+'b'`

如果在一个循环中，基本字符串位于最左端，这样就可以避免多次复制一个越来越大的基本字符串。


在赋值表达式中所有字符串连接都属于编译期常量，Firefox 自动地在编译过程中合并它们。当字符串是这样合并在一起时，由于运行时没有中间字符串，所以连接它们的时间和内存可以减少到零。这种功能非常了不起，但它并不经常起作用，因为通常从运行期数据创建字符串而不是从编译期常量。
（**经过测试发现：在chrome中第一种时间最短，第二种比第三种略快一点点，应该是v8引擎优化造成，在chrome浏览器上开发还是使用最简洁的语句为好，可能是对常用语法进行了优化**）

## 数组连接

在大多数浏览器上，数组连接比字符串的其他方法更慢，但是事实上，作为一种补偿方法，在ie7和更早的浏览器上它是连接大量字符串唯一高效的途径。

## 正则表达式

正则表达式的工作流程：
1. 编译
2. 设置起始位置
3. 开始匹配
4. 匹配成功或失败

在大多数现代正则表达式实现中，回溯是匹配过程的基本组成部分，然而回溯的计算代价昂贵，减少使用频率可能是编写高效正则表达式的关键。

## 总结

- 密集的字符串操作和正则表达式可能会成为性能障碍
- 连接数量巨大或者尺寸巨大的字符串，数组联合（concat）是ie7以及更早版本的浏览器的唯一有效方法
- 如果是其他版本的浏览器，数组联合可能是最慢的方法之一，直接使用 `+` 或者 `+=` 
- 回溯既是正则表达式匹配功能基本的组成部分，又是正则表达式影响效率的常见原因
- 回溯失控发生在正则表达式本应很快发现匹配的地方，因为某些特殊的匹配字符串动作，导致运行缓慢甚至浏览器崩溃。避免此问题的技术包括：使相邻字元互斥，避免嵌套量词对一个字符串的相同部分多次匹配，通过重复利用前瞻操作的原子特性去除不必要的回溯
- 正则表达式并不总是完成工作的最佳工具，尤其当你只是搜索一个文本字符串
