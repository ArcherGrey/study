# 算法和流程控制
代码整体结构是执行速度的决定因素之一。代码量少不一定运行速度快，代码量多也不一定运行速度慢。性能损失与代码组织方式和具体问题解决办法直接相关。

## 循环
循环的类型：
- `for` 大概是最常用的循环结构，由四个部分组成：初始化体、前测条件、后执行体、循环体
```
for(初始化体;前测条件;后执行体){
  循环体
}
```
- `while` 是一个简单的预测试循环，由一个预测试条件和一个循环体构成
```
while(预测试条件){
  循环体
}
```
- `do while` 循环中，循环体至少运行一次，后测试条件决定循环体是否应再次执行
```
do{
  循环体
}while(后测试条件)
```
- `for-in` 用来枚举任何对象的命名属性，每次循环执行，属性变量被填充以对象属性的名字（一个字符串），直到所有的对象属性遍历完成才返回。返回的属性包括对象的实例属性和它从原型链继承而来的属性。
```
for(var a in onject){
  循环体
}
```

### 循环性能

在javascript的四种循环类型中，只有`for-in`循环明显要慢。

由于每次迭代操作要搜索实例或原形的属性，for-in 循环每次迭代都要付出更多开销，所以比其他类型循环慢一些。在同样的循环迭代操作中，for-in 循环比其他类型的循环慢7 倍之多。因此推荐的做法如下：除非你需要对数目不详的对象属性进行操作，否则避免使用for-in 循环。

除for-in 循环外，其他循环类型性能相当，难以确定哪种循环更快。选择循环类型应基于需求而不是性能。
如果循环类型与性能无关，那么如何选择？其实只有两个因素：
- 每次迭代做什么
- 迭代的次数

通过减少两者中的一个或者全部，都可以积极的影响循环的整体性能。

#### 减少迭代的工作量

不言而喻，如果一次循环迭代需要较长时间来执行，那么多次循环将需要更长时间。限制在循环体内进行耗时操作的数量是一个加快循环的好方法。

优化循环工作量的第一步是减少对象成员和数组项查找的次数。在大多数浏览器上，这些操作比访问局部变量或直接量需要更长时间。前面的例子中每次循环都查找items.length。这是一种浪费，因为该值在循环体执行过程中不会改变，因此产生了不必要的性能损失。你可以简单地将此值存入一个局部变量中，在控制条件中使用这个局部变量，从而提高了循环性能。
（chrome里面用局部变量代替length效率没什么提升甚至会降低效率，这个似乎在v8中自动优化了）

你还可以通过改变他们的顺序提高循环性能。通常，数组元素的处理顺序与任务无关，你可以从最后一个开始，直到处理完第一个元素。倒序循环是编程语言中常用的性能优化方法，但一般来说不太容易理解。在JavaScript 中，倒序循环可以略微提高循环性能，只要你消除因此而产生的额外操作。
（倒序循环也没发现性能提升）

#### 减少迭代次数
即使循环体中最快的代码，累计迭代上千次（也将是不小的负担）。此外，每次运行循环体时都会产生一个很小的性能开销，也会增加总的运行时间。减少循环的迭代次数可获得显著的性能提升。最广为人知的限制循环迭代次数的模式称作“达夫设备”。
达夫设备是一个循环体展开技术，在一次迭代中实际上执行了多次迭代操作。Jeff Greenberg 被认为是将达夫循环从原始的C 实现移植到JavaScript 中的第一人。一个典型的实现如下：
```
var iterations = Math.floor(items.length / 8),
startAt = items.length % 8,
i = 0;
do {
switch(startAt){
case 0: process(items[i++]);
case 7: process(items[i++]);
case 6: process(items[i++]);
case 5: process(items[i++]);
case 4: process(items[i++]);
case 3: process(items[i++]);
case 2: process(items[i++]);
case 1: process(items[i++]);
}
startAt = 0;
} while (--iterations);
```

达夫设备背后的基本理念是：每次循环中最多可8 次调用process()函数。循环迭代次数为元素总数除以8。因为总数不一定是8 的整数倍，所以startAt 变量存放余数，指出第一次循环中应当执行多少次process()。比方说现在有12 个元素，那么第一次循环将调用process()4 次，第二次循环调用process()8 次，用2 次循环代替了12 次循环。

是否值得使用达夫设备，无论是原始的版本还是修改后的版本，很大程度上依赖于迭代的次数。如果循环迭代次数少于1'000 次，你可能只看到它与普通循环相比只有微不足道的性能提升。如果迭代次数超过1'000 次，达夫设备的效率将明显提升。例如500'000 次迭代中，运行时间比普通循环减少到70%。

## 总结
- for，while，do-while 循环的性能特性相似，谁也不比谁更快或更慢
- 除非你要迭代遍历一个属性未知的对象，否则不要使用for-in 循环
- 改善循环性能的最好办法是减少每次迭代中的运算量，并减少循环迭代次数
- 一般来说，switch 总是比if-else 更快，但并不总是最好的解决方法
- 当判断条件较多时，查表法比if-else 或者switch 更快
- 浏览器的调用栈尺寸限制了递归算法在JavaScript 中的应用；栈溢出错误导致其他代码也不能正常执行
- 如果你遇到一个栈溢出错误，将方法修改为一个迭代算法或者使用制表法可以避免重复工作
- 运行的代码总量越大，使用这些策略所带来的性能提升就越明显



