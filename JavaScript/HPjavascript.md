# 加载和运行

`<script>` 标签使得整个页面因为脚本解析、运行而出现等待，无论是内联还是包含在外边文件中的 javascript 代码，在`页面下载`和`解析过程`的时候都会使页面阻塞等待这些处理完成才能继续。

因为无法预知javascript是否会对页面进行修改，所以浏览器会停下来运行javascript然后继续解析翻译页面。这个过程中，页面解析和用户交互式被完全阻塞的。

## 脚本位置

`问题`：浏览器在遇到 `<body>` 标签的时候才会开始渲染，如果将脚本文件放在之前那么将会先下载运行脚本文件再进行渲染，这样做会使得其他页面资源被阻塞，也就是网页开始加载时用户必须等待一段空白页面直到脚本下载并且运行完成。

`解决`：推荐的办法是尽量将脚本文件放在 `<body>` 标签的底部位置，尽量减少对整个页面下载的影响。 

> 将脚本放在底部

## 脚本数量

`问题`：每个 `<script>` 标签下载时都会阻塞页面解析过程，下载一个100KB的文件比四个25KB的文件要快。（因为每个文件的下载都是http请求，文件数量多了请求数量也就多了）
`解决`：将多个脚本文件整个成一个文件，只使用一个标签引用，可以通过打包工具实现。

> 脚本文件越少越好

## 非阻塞脚本

`问题`：保持脚本文件短小，限制http请求数量，只是创建反应迅速的网页应用的第一步。一个应用程序所包含的功能越多所需要的javascript代码就越多，保持源码短小并不是总能实现。尽管下载一个大的javascript文件只产生一次请求，却会锁定浏览器一大段时间，为了解决这个问题我们需要向页面中逐步添加javascript，同时不阻塞浏览器。

`解决`：非阻塞脚本的秘密在于，等页面完成加载之后，再加载javascript。也就是说在页面 load 事件完成之后开始下载代码。

主要有下面几种方式实现：
- 延期脚本：html4 为 `<script>` 标签定义了一个扩展属性 `defer`。这个属性指明所包含的脚本不会修改DOM，因此代码可以稍后执行。这个方法需要 `Internet Explorer 4` 和 `Firefox 3.5` 更高版本的浏览器支持，如果浏览器支持的话，是一种可行的解决方案。带有扩展属性 `defer`的标签可以放在文档的任何位置。（经测试chrome不支持）
- 
