# C++ Primer 阅读笔记（第六章）
## 6.函数
### 6.1 基础
一个典型的函数包括： 返回类型 + 函数名 + 形参 + 函数体。

函数调用完成两个工作： 用实参初始化相应形参 + 将控制权转移给要调用函数。

名字的作用域是程序文本的一部分，名字在其中可见。

对象的生命周期是程序执行过程中该对象存在的一段时间。

局部静态变量可以使局部变量的生命周期贯穿整个程序执行过程。

函数必须在使用前声明。一般在头文件中声明。


----------
### 6.2 参数传递
> 传值参数

当初始化一个非引用类型变量时，初始值会被拷贝给变量，对变量的操作不会影响到初始值。

> 指针形参

指针的行为和其他非引用类型一样。当执行指针拷贝操作时，拷贝的是指针的值。拷贝之后，两个指针是不同的指针。可以通过指针间接的访问所指对象，也可以通过指针修改所指对象的值。

> 传引用参数

 使用引用能够避免拷贝，拷贝大的类型对象或者容器对象比较低效，还有些不支持拷贝，只能通过引用来访问对象，如果函数无需改变形参的值，最好声明为常量引用。

一个函数只能返回一个值，但是有的时候需要返回多个值，通过引用形参就可以返回额外的信息。

> const 形参和实参

在初始化过程中，形参的顶层 `const` 会被忽略。例如：

    void foo(const int i);
    void foo(int i); //是一样的会产生错误

如果函数有不会改变的形参，要写成常量引用。

> 数组形参

数组有两个特殊的性质：

- 不允许拷贝数组
- 使用数组时会转换成指针

因为不能拷贝所以不能使用值传递，传递数组时实际上是传递指向数组头元素的指针。

有下面几种方法来保证参数传递时，数组不会产生越界错误：

- 使用标记，在数组尾设置特殊的结束标记，通过标记来判断数组是否结束。
- 根据STL的思想，使用头指针和尾后指针，两个指针相等时，数组结束。
- 显示传递一个表示数组大小的形参。

> main 处理命令行选项

    int main(int argc, char *argv[]){...}
有时需要给 `main` 传递实参：

- `argv` 是一个数组，元素是指向C风格字符串的指针。第一个元素是程序名字或者空字符串。
- `argc` 表示字符串的数量。

> 含有可变形参的函数

为了编写能够处理不同数量形参的函数，C++11提供了两种主要的方法：

- 如果所有形参的类型相同可以传递一个名为 `initializer_list` 的标准库类型，也就是把所有参数都存到这个容器中
- 如果参数类型不同，可以编写一种特殊的函数，也就是可变参数模板

还有一种方法是用来访问C代码设置的，就是省略符形参，省略符形参只能出现在形参的最后一个位置。

----------
### 6.3 返回类型和return 语句
> 无返回值函数

 `void` 函数如果在中间位置想要提前退出，可以使用 `return;` 提前退出。也可以返回另一个 `void` 函数。

> 有返回值函数

返回值不能是 `void` ，每条返回语句只能返回一个值，类型必须和函数返回类型一致。

> 值是如何返回的

返回一个值的方式和初始化一个变量或者形参的方式完全一样。返回的值用于初始化调用点的一个临时量，也就是函数调用的结果。

> 不要返回局部对象的引用或者指针

函数结束后，局部变量的引用和指针都会无效。

> 引用返回左值

调用一个返回引用的函数得到左值，其他返回类型返回右值。

> 列表初始化返回值

函数可以返回花括号包围的值的列表，常常用来列表初始化。

> main 的返回值

允许 `main` 没有 `return` 语句直接结束，编译器会隐式的插入一条返回 0 的语句。

> 返回数组指针

因为数组不能被拷贝，所以函数不能返回数组。但是可以返回数组的指针或引用。

> 使用尾置返回类型

对于返回数组的指针或者引用最为有效，在形参列表后面以 `->`开头，函数的返回值为 `auto`，例如： 

    auto func(int i) -> int (*)[10]; //表示返回一个含有10个整数的数组的指针

> 使用decltype

在知道函数返回的指针指向哪个数组，就可以使用 `decltype` 来声明返回类型。


----------
### 6.4 函数重载

函数名相同，但是形参列表不同的称为重载， main 函数不能重载。

通过函数匹配来确定具体调用哪一个重载函数。当调用重载函数时可能有下面三种情况：

- 编译器找到一个最佳匹配的函数，生成调用函数的代码
- 找不到能够匹配的函数，发出无匹配的错误信息
- 有多个可以调用的函数，但是都不是最佳选择，也会产生错误，称为二义性调用


----------
### 6.5 特殊用途语言特性
> 默认实参

可以为一个或多个形参设置默认实参，不过一旦某个形参被赋予了默认值，后面的形参都必须有默认值。设计函数时应该让带有默认值的实参放在后面。多次声明同一个函数只能给没有默认值的形参添加实参。

> 内联函数

内联函数就像是把函数中的操作作为一个别名，不会产生函数调用，所以开销要比普通函数调用要小。一般适用于操作少，使用频繁的函数。

 `constexpr` 函数会被隐式的指定为内联函数。

内联函数一般都放在头文件内。

> assert 预处理宏

预处理宏就是一个预处理变量，类似于内联函数。

形式是： `assert(expr);`

如果表达式为假，输出信息并终止程序，为真 `assert` 不做任何操作。

常用来检查不能发生的条件。

> NDEBUG 预处理变量

如果定义了 `NDEBUG` ，则 `assert` 什么也不做。默认情况下，没有定义， `assert` 将执行运行时检查。


----------
### 6.6 函数匹配
步骤：

- 选定本次调用对应的重载函数集， 集合中的函数称为候选函数，候选函数由两个特征：与被调用函数同名，声明在调用点可见。
- 考察本次调用的实参，然后从候选函数中选出能这组实参调用的函数，选出来的函数称为可行函数。这些函数由两个特征：形参数量和本次调用提供的实参相等，类型对应相同或者可以转换成相应的类型。
- 最后是从可行函数中选择最匹配函数。基本思想是类型越接近匹配的越好。

为了确定最佳匹配，编译器将实参类型到形参类型的转换化成了几个等级：

- 精确匹配：类型相同，可以转换成对应的指针类型，只有顶层 `const` 差异
- 通过 `const` 转换实现的匹配
- 通过类型提升实现的匹配
- 通过算术类型转换或指针转换实现的匹配
- 通过类类型转换实现的匹配

----------

### 6.7 函数指针
函数指针指向的是函数而非对象。


