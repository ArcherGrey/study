# ICMP 协议
> ICMP工作在TCP/IP协议族的网际层，用于传输在TCP/IP通信中产生的错误报告、通信控制信息和请求应答信息。

> ICMP弥补了IP协议的缺陷，使用IP协议进行信息传递，向数据包中的源端节点提供错误反馈信息。

> 它的报文不直接传送给数据链路层，而是封装在IP数据报的数据部分，再传送给数据链路层，可以看做是对于IP协议不可靠性的一个补充。

> ICMP的差错报告和控制报文的共同特点是单向的报文传输。但是差错报告只有一对一通信模式，控制报文不但有一对一还有一对多模式。请求应答报文提供了双向报文传输。

## 协议结构
> 长度可变，其中固定的部分4个字节，分为以下几个段落：
> 
- 类型：标识报文的类型。
- 代码：对报文类型进一步说明。
- 校验和：以16位为单位计算出来的报文的校验和值。
- 数据区：不同类型和代码有不同的数据区包含不同的内容，可以用于报文分析和处理。

## 主要报文类型
### 差错报告报文
- 目标不可达：当报文无法传送到目标主机时，路由器或主机将产生该报文，并将其发送给源主机。有16种代码。
- 超时：如果路由表出现问题，整个网络的寻址将出现不一致性，极端情况是造成数据报在某些路由器之间循环，使数据在其中无休止地传输。为了防止这种情况出现，IP协议采取了两个措施：添加TTL字段和定时器技术。一旦定时时间到，路由器或目的主机立即抛弃本数据报，并向源主机发送超时报文。
- 参数出错：数据报在传输过程中，当报头或者选项参数出现错误，路由器或目的主机将丢弃该数据报，并发送参数出错报文给源主机。但报文只能报告出错状态或者丢失的参数数目，而不能说明缺少哪个参数。

### 控制报文
- 源抑制：当路由器或主机由于拥塞而丢掉数据报时，它就向数据报的源主机发送源抑制报文，抑制源主机发送数据报的速率。
- 重定向：主机启动时只知道最少的寻址信息，启动后通过重定向报文从路由器获取信息，可以保证主机拥有一个动态的而且小而优的路由表。

### 请求应答报文


- 回应请求/应答:目的是测试目的主机是否可以到达，ping命令就是。
- 路由器请求/通告：用来初始化路由表。
- 时间戳请求/应答：同步网络中各个主机的时间。
- 地址掩码请求/应答：为了正确的解析IP地址，需要发出地址掩码请求报文，路由器发回相应的应答报文。